---
import DefaultLayout from '../layouts/DefaultLayout.astro';
import PageHeader from './PageHeader.astro';
import { getGeneralPageBySlug } from '../utils/static-content';
import { renderSafeContent } from '../utils/renderContent';

interface Props {
  slug: string;
  fallbackTitle?: string;
  fallbackSubtitle?: string;
  fallbackContent?: string;
}

const {
  slug,
  fallbackTitle,
  fallbackSubtitle,
  fallbackContent = '',
} = Astro.props;

// Get data from static content
const pageData = getGeneralPageBySlug(slug);
let pageTitle = fallbackTitle || 'Page';
let pageSubtitle = fallbackSubtitle || '';
let pageContent = fallbackContent;

if (pageData) {
  pageTitle = pageData.title || fallbackTitle || 'Page';
  pageSubtitle = pageData.subtitle || fallbackSubtitle || '';

  // Render safe content from Strapi
  if (pageData.content) {
    pageContent = renderSafeContent(pageData.content);
  }
} else if (fallbackContent) {
  // Process fallback content
  pageContent = renderSafeContent(fallbackContent);
}
---

<DefaultLayout
  title={`${pageTitle} - Hopkins Creek Festival`}
  description={pageSubtitle || `${pageTitle} - Hopkins Creek Festival`}
>
  <PageHeader
    title={pageTitle}
    subtitle={pageSubtitle}
  />

  <section class="container my-16 narrow">
    <div class="space-content">
      <div set:html={pageContent} />
      <slot />
    </div>
  </section>
</DefaultLayout>

<style lang="scss">
  /*
    Note: Content is injected via set:html and does NOT receive Astro's scoped
    attributes. Use :global() on descendants so spacing/typography rules apply.
  */
  .space-content {
    :global(h2) {
      font-weight: bold;
      margin-top: var(--space-l);
      margin-bottom: var(--space-m);
    }

    :global(h3) {
      font-weight: bold;
      margin-top: var(--space-m);
      margin-bottom: var(--space-s);
    }

    :global(p) {
      margin-bottom: var(--space-m);
      line-height: 1.6;
    }

    :global(ul), :global(ol) {
      margin-bottom: var(--space-m);
      padding-left: var(--space-m);
    }

    :global(ul li), :global(ol li) {
      margin-bottom: var(--space-xs);
      line-height: 1.6;
    }

    :global(strong) {
      font-weight: 600;
    }

    :global(a) {
      color: var(--color-primary);
      text-decoration: underline;
    }

    :global(a:hover) {
      color: var(--color-primary-dark);
    }
  }
</style>
