---
interface AccordionSection {
  title: string;
  details: any;
  category?: string;
}

interface Props {
  sections: AccordionSection[];
  name: string;
  alwaysOpen?: boolean;
  titleClass?: string;
}

const { sections = [], name = 'accordion', alwaysOpen = false, titleClass = '' } = Astro.props;
const accordionId = `accordion-${name}`;
const accordionMode = alwaysOpen ? 'open' : 'collapse';
---

{sections.length > 0 && (
  <div
    id={accordionId}
    data-accordion={accordionMode}
    class="w-full"
  >
    {sections.map((section, index) => {
      const headingId = `${accordionId}-heading-${index + 1}`;
      const bodyId = `${accordionId}-body-${index + 1}`;

      return (
        <Fragment>
          <h2 id={headingId}>
            <button
              type="button"
              class={`flex items-center justify-between w-full py-6 px-6 border border-gray-200 ${index !== 0 ? 'border-t-0' : ''} text-base md:text-lg text-black dark:text-white focus:outline-none focus-visible:ring-2 focus-visible:ring-primary-500 transition-all duration-200 bg-transparent group`}
              data-accordion-target={`#${bodyId}`}
              aria-expanded="false"
              aria-controls={bodyId}
            >
              <span class={`w-full text-left text-base md:text-lg ${titleClass}`}>{section.title}</span>
              {/* Minimal + icon, rotates to × when open */}
              <span
                class="ml-2 text-lg transition-transform duration-200 accordion-plus"
                aria-hidden="true"
              >
                +
              </span>
            </button>
          </h2>
          <div
            id={bodyId}
            class={`hidden border border-gray-200 border-t-0 ${index === sections.length - 1 ? '' : 'border-b-0'}`}
            aria-labelledby={headingId}
          >
            <div class="py-4 px-5">
              <div class="prose dark:prose-invert max-w-none">
                <Fragment set:html={section.details} />
              </div>
            </div>
          </div>
        </Fragment>
      );
    })}
  </div>
)}

{sections.length === 0 && (
  <div class="text-center py-8">
    <p class="text-gray-500 dark:text-gray-400">No information available at this time.</p>
  </div>
)}

<style>
[data-accordion] {
  border-bottom: none;
  overflow: hidden;
}

[data-accordion] .accordion-plus {
  display: inline-block;
  transition: transform 0.2s;
}

[data-accordion] [aria-expanded="true"] .accordion-plus {
  transform: rotate(45deg); /* + becomes × (close) */
}

/* Direct button hover styling */
[data-accordion] button[data-accordion-target] {
  transition: all 0.2s ease;
}

[data-accordion] button[data-accordion-target]:hover,
[data-accordion] button[data-accordion-target]:focus-visible {
  text-decoration: underline;
}

[data-accordion] h2 > button {
  /* Use Diatype Semi Mono Medium for accordion titles */
  font-family: "ABC Diatype Semi Mono", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif !important;
  font-weight: 500 !important;
}
</style>