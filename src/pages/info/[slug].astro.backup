---
import InfoPageLayout from "../../components/InfoPageLayout.astro";
import { fetchAllInfoPages } from "../../lib/strapi";

// Static generation: Get all possible slugs
export async function getStaticPaths() {
  try {
    const response = await fetchAllInfoPages();
    
    // Check if response and response.data exist
    if (!response || !response.data || !Array.isArray(response.data)) {
      console.warn('Invalid API response structure, using fallback routes');
      throw new Error('Invalid API response');
    }
    
    const infoPages = response.data;

    // Filter out pages with null or invalid slugs
    const validPages = infoPages.filter(
      (page: any) =>
        page.slug &&
        typeof page.slug === 'string' &&
        page.slug.trim().length > 0
    );

    // If no valid pages found, use fallbacks
    if (validPages.length === 0) {
      console.warn('No valid info pages found with slugs, using fallback routes');
      throw new Error('No valid pages');
    }

    console.log(`Found ${validPages.length} valid info pages:`, validPages.map(p => p.slug));
    
    return validPages.map((page: any) => ({
      params: { slug: page.slug },
    }));
  } catch (error) {
    console.warn("Failed to fetch info pages for static generation:", error);

    // Fallback slugs for development/backup
    return [
      { params: { slug: "camping" } },
      { params: { slug: "accessibility" } },
      { params: { slug: "tickets" } },
      { params: { slug: "getting-there" } },
      { params: { slug: "motor-inn" } },
      { params: { slug: "food-beverages" } },
      { params: { slug: "applications" } },
    ];
  }
}

// Get the slug from the URL
const { slug } = Astro.params;

// Define comprehensive fallback content for each page
const fallbackContent = {
  camping: {
    heading: "Camping & Accommodation",
    subheading: "Find your perfect camping spot at Hopkins Creek Festival",
    accordion: [
      {
        title: "Camping Options Available",
        details:
          "<p>Choose from various camping options to suit your festival experience.</p><ul><li>Powered camping sites with electrical hookups</li><li>Unpowered camping areas in scenic locations</li><li>Group camping areas for larger parties</li><li>Glamping options with pre-set tents</li></ul>",
        category: "general",
      },
      {
        title: "What to Bring",
        details:
          "<p>Essential items for a comfortable camping experience:</p><ul><li>Tent and camping gear</li><li>Portable chairs and tables</li><li>Cooler and ice packs</li><li>Flashlight and batteries</li></ul>",
        category: "general",
      },
    ],
  },

  accessibility: {
    heading: "Accessibility Information",
    subheading: "Making Hopkins Creek Festival accessible for everyone",
    accordion: [
      {
        title: "Accessibility Features",
        details:
          "<p>We're committed to ensuring everyone can enjoy Hopkins Creek Festival.</p><ul><li>Wheelchair accessible pathways and viewing areas</li><li>Accessible toilet facilities throughout the site</li><li>Reserved parking spaces close to entrances</li><li>Audio description services available</li></ul>",
        category: "accessibility",
      },
    ],
  },

  tickets: {
    heading: "Tickets & Pricing",
    subheading: "Choose your festival experience",
    accordion: [
      {
        title: "Ticket Options",
        details:
          "<p>Multiple ticket types available to suit different budgets and preferences.</p><ul><li>Single day passes</li><li>Full festival weekend passes</li><li>VIP packages with exclusive access</li><li>Group discounts available</li></ul>",
        category: "tickets",
      },
    ],
  },

  "getting-there": {
    heading: "Getting There",
    subheading: "Travel information and directions to Hopkins Creek Festival",
    accordion: [
      {
        title: "Transport Options",
        details:
          "<p>Multiple ways to reach Hopkins Creek Festival site.</p><ul><li>Free parking available on-site</li><li>Shuttle buses from town center</li><li>Train station 2km from festival grounds</li><li>Bicycle parking areas provided</li></ul>",
        category: "transport",
      },
    ],
  },

  "motor-inn": {
    heading: "The Motor Inn",
    subheading: "Comfortable accommodation packages",
    accordion: [
      {
        title: "Motor Inn Packages",
        details:
          "<p>Stay comfortably at our partner Motor Inn with festival packages.</p><ul><li>Standard rooms with festival tickets included</li><li>Deluxe suites with VIP access</li><li>Complimentary breakfast and shuttle service</li></ul>",
        category: "general",
      },
    ],
  },

  "food-beverages": {
    heading: "Food & Beverages",
    subheading: "Delicious food and drinks await",
    accordion: [
      {
        title: "Food Options",
        details:
          "<p>Wide variety of food vendors and beverage options throughout the festival.</p><ul><li>Local food trucks and vendors</li><li>Vegetarian and vegan options available</li><li>Licensed bar areas</li><li>Coffee and snack stations</li></ul>",
        category: "general",
      },
    ],
  },
};

// Get fallback content or default
const fallback = fallbackContent[slug as keyof typeof fallbackContent] || {
  heading: "Festival Information",
  subheading: "Information about Hopkins Creek Festival",
  accordion: [],
};
---

<InfoPageLayout
  slug={slug || ""}
  fallbackHeading={fallback.heading}
  fallbackSubheading={fallback.subheading}
  fallbackAccordion={fallback.accordion}
/>
