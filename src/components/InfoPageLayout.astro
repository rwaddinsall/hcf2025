---
import DefaultLayout from '../layouts/DefaultLayout.astro';
import PageHeader from './PageHeader.astro';
import { Accordion, AccordionItem } from 'accessible-astro-components';

import { getInfoPageBySlug } from '../utils/static-content';
import { renderSafeContent } from '../utils/renderContent';

interface AccordionSection {
  title: string;
  details: any;
  category?: string;
}

interface Props {
  slug: string;


  fallbackHeading?: string;
  fallbackSubheading?: string;
  fallbackAccordion?: AccordionSection[];
}

const {
  slug,
  fallbackHeading,
  fallbackSubheading,
  fallbackAccordion = [],
} = Astro.props;

// Get data from static content
const pageData = getInfoPageBySlug(slug);
let pageHeading = fallbackHeading || 'Information';
let pageSubheading = fallbackSubheading || '';
let accordionSections = fallbackAccordion;

if (pageData) {
  pageHeading = pageData.heading || fallbackHeading || 'Information';
  pageSubheading = pageData.subheading || fallbackSubheading || '';

  // Use accordion data directly from static content
  if (pageData.accordion && pageData.accordion.length > 0) {
    accordionSections = pageData.accordion.map((section) => ({
      ...section,
      details: renderSafeContent(section.details),
    }));
  }
} else if (fallbackAccordion.length > 0) {
  // Also process fallback accordion sections
  accordionSections = fallbackAccordion.map((section) => ({
    ...section,
    details: renderSafeContent(section.details),
  }));
}
---

<DefaultLayout
  title={`${pageHeading} - Hopkins Creek Festival`}
  description={pageSubheading ||
    `${pageHeading} information for Hopkins Creek Festival`}
>
  <section class='mt-20 mb-12'>
    <PageHeader title={pageHeading} subtitle={pageSubheading} />


    <div class='container'>
      <div class='space-content'>
        <div class='accordion-container'>
          <Accordion>
            {accordionSections.map((section: AccordionSection) => (
              <AccordionItem title={section.title} variant="chevron">
                <div set:html={section.details} />
              </AccordionItem>
            ))}
          </Accordion>
        </div>
        <slot />
      </div>
    </div>
  </section>
</DefaultLayout>

<style lang='scss'>
  .space-content {
    h4 {
      font-weight: 500; // Use medium weight instead of bold to match design system
      margin-top: var(--space-m);
      margin-bottom: var(--space-s);
      color: var(--foreground-color);
    }

    ul {
      margin-bottom: var(--space-l);
    }

    li {
      margin-bottom: var(--space-2xs);
    }

    p {
      margin-bottom: var(--space-m);
      line-height: var(--line-height-relaxed);
      color: var(--foreground-color);

      &:last-child {
        margin-bottom: 0;
      }
    }

    // Accordion container styling
    .accordion-container {
      // No borders on container itself
    }

    // Style accordion container's first and last children with global technique
    :global(.accordion-container > *:first-child) {
      border-top: 2px solid black !important;
    }

    :global(.accordion-container > *:last-child) {
      border-bottom: 2px solid black !important;
    }

    // Accordion items with consistent 2px black borders
    :global(.accordion) {
      border: none;
    }

    :global(.accordion > .accordion-item) {
      border-left: 2px solid black !important;
      border-right: 2px solid black !important;
      border-top: 2px solid black !important;
      border-bottom: none !important;
    }

    // First accordion item gets top border
    :global(.accordion > .accordion-item:first-child) {
      border-top: 2px solid black !important;
    }

    // Last accordion item gets bottom border
    :global(.accordion > .accordion-item:last-child) {
      border-bottom: 2px solid black !important;
    }
  }
</style>
