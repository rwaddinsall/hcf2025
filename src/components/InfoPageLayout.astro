---
import DefaultLayout from '../layouts/DefaultLayout.astro';
import PageHeader from './PageHeader.astro';
import Accordion from './Accordion.astro';
import { getInfoPageBySlug } from '../utils/static-content';
import { renderSafeContent } from '../utils/renderContent';

interface AccordionSection {
  title: string;
  details: any;
  category?: string;
}

interface Props {
  slug: string;
  fallbackHeading?: string;
  fallbackSubheading?: string;
  fallbackAccordion?: AccordionSection[];
}

const {
  slug,
  fallbackHeading,
  fallbackSubheading,
  fallbackAccordion = [],
} = Astro.props;

// Get data from static content
const pageData = getInfoPageBySlug(slug);
let pageHeading = fallbackHeading || 'Information';
let pageSubheading = fallbackSubheading || '';
let accordionSections = fallbackAccordion;

if (pageData) {
  pageHeading = pageData.heading || fallbackHeading || 'Information';
  pageSubheading = pageData.subheading || fallbackSubheading || '';

  // Use accordion data directly from static content
  if (pageData.accordion && pageData.accordion.length > 0) {
    accordionSections = pageData.accordion.map((section) => ({
      ...section,
      details: renderSafeContent(section.details),
    }));
  }
} else if (fallbackAccordion.length > 0) {
  // Also process fallback accordion sections
  accordionSections = fallbackAccordion.map((section) => ({
    ...section,
    details: renderSafeContent(section.details),
  }));
}
---

<!--
DEBUG BORDERS LEGEND:
ðŸ©· Pink: PageHeader wrapper (title/subtitle)
ðŸ”´ Red: Main container (my-16 narrow)
ðŸ”µ Blue: Section container (space-content mb-12)
ðŸŸ¢ Green: Accordion wrapper
ðŸŸ£ Purple: Slot content area
--><DefaultLayout
  title={`${pageHeading} - Hopkins Creek Festival`}
  description={pageSubheading ||
    `${pageHeading} information for Hopkins Creek Festival`}
>
  <!-- Remove duplicate main element - DefaultLayout already provides main container -->
  <PageHeader title={pageHeading} subtitle={pageSubheading} />

  <section class="space-content mb-12 w-full" aria-labelledby="info-heading">
    <Accordion sections={accordionSections} name={slug} titleClass="text-xl md:text-2xl font-mono" />

    <div class="mt-4">
      <slot />
    </div>
  </section>
</DefaultLayout>

<style lang='scss'>
  .space-content {
    h4 {
      font-weight: bold;
      margin-top: var(--space-m);
      margin-bottom: var(--space-s);
      color: var(--foreground-color);
    }

    ul {
      margin-bottom: var(--space-m);
    }

    li {
      margin-bottom: var(--space-2xs);
    }

    p {
      margin-bottom: var(--space-m);
      line-height: var(--line-height-relaxed);
      color: var(--foreground-color);

      &:last-child {
        margin-bottom: 0;
      }
    }

    .content-link {
      color: var(--link-color);
      text-decoration: underline;
      font-weight: 500;

      &:hover,
      &:focus-visible {
        color: var(--link-hover-color);
      }
    }
  }

  // Responsive adjustments
  @media (max-width: 48rem) {
    .space-content {
      padding: 0 var(--space-s);
    }
  }
</style>

